"use strict";(self.webpackChunkdynamode_docs=self.webpackChunkdynamode_docs||[]).push([[414],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||i;return n?a.createElement(h,s(s({ref:t},c),{},{components:n})):a.createElement(h,s({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var u=2;u<i;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),r=n(6010);const i="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,s),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(7462),r=n(7294),i=n(6010),s=n(2389),o=n(7392),l=n(7094),u=n(2466);const c="tabList__CuJ",d="tabItem_LNqP";function p(e){var t;const{lazy:n,block:s,defaultValue:p,values:m,groupId:h,className:b}=e,y=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=m??y.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,o.l)(k,((e,t)=>e.value===t.value));if(g.length>0)throw new Error(`Docusaurus error: Duplicate values "${g.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===p?p:p??(null==(t=y.find((e=>e.props.default)))?void 0:t.props.value)??y[0].props.value;if(null!==v&&!k.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${k.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:N,setTabGroupChoices:f}=(0,l.U)(),[S,w]=(0,r.useState)(v),C=[],{blockElementScrollPositionUntilNextRender:D}=(0,u.o5)();if(null!=h){const e=N[h];null!=e&&e!==S&&k.some((t=>t.value===e))&&w(e)}const T=e=>{const t=e.currentTarget,n=C.indexOf(t),a=k[n].value;a!==S&&(D(t),w(a),null!=h&&f(h,String(a)))},x=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=C.indexOf(e.currentTarget)+1;n=C[t]??C[0];break}case"ArrowLeft":{const t=C.indexOf(e.currentTarget)-1;n=C[t]??C[C.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",c)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":s},b)},k.map((e=>{let{value:t,label:n,attributes:s}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,key:t,ref:e=>C.push(e),onKeyDown:x,onFocus:T,onClick:T},s,{className:(0,i.Z)("tabs__item",d,null==s?void 0:s.className,{"tabs__item--active":S===t})}),n??t)}))),n?(0,r.cloneElement)(y.filter((e=>e.props.value===S))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},y.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==S})))))}function m(e){const t=(0,s.Z)();return r.createElement(p,(0,a.Z)({key:String(t)},e))}},8268:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),i=n(5488),s=n(5162);const o={title:"Scan | Dynamode",description:"Scan",sidebar_label:"Scan",hide_title:!0},l="Scan",u={unversionedId:"guide/scan",id:"guide/scan",title:"Scan | Dynamode",description:"Scan",source:"@site/docs/guide/scan.mdx",sourceDirName:"guide",slug:"/guide/scan",permalink:"/dynamode/docs/guide/scan",draft:!1,editUrl:"https://github.com/blazejkustra/dynamode/tree/master/docs/docs/guide/scan.mdx",tags:[],version:"current",frontMatter:{title:"Scan | Dynamode",description:"Scan",sidebar_label:"Scan",hide_title:!0},sidebar:"sidebar",previous:{title:"Query",permalink:"/dynamode/docs/guide/query"},next:{title:"Transactions",permalink:"/dynamode/docs/guide/transactions"}},c={},d=[{value:"Condition",id:"condition",level:2},{value:"<code>new Scan(Entity)</code> or <code>Entity.scan()</code>",id:"new-scanentity-or-entityscan",level:2},{value:"<code>Scan.indexName(name)</code>",id:"scanindexnamename",level:2},{value:"<code>Scan.segment(value)</code>",id:"scansegmentvalue",level:2},{value:"<code>Scan.totalSegments(value)</code>",id:"scantotalsegmentsvalue",level:2},{value:"<code>Scan.limit(count)</code>",id:"scanlimitcount",level:2},{value:"<code>Scan.startAt(key)</code>",id:"scanstartatkey",level:2},{value:"<code>Scan.consistent()</code>",id:"scanconsistent",level:2},{value:"<code>Scan.count()</code>",id:"scancount",level:2},{value:"<code>Scan.attributes(attributes)</code>",id:"scanattributesattributes",level:2},{value:"<code>Scan.run(options?)</code>",id:"scanrunoptions",level:2},{value:"Description",id:"description",level:3},{value:"Arguments",id:"arguments",level:3},{value:"Examples",id:"examples",level:3}],p={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"scan"},"Scan"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://www.dynamodbguide.com/scans"},(0,r.kt)("em",{parentName:"a"},"Never use the Scan operation unless you know what you are doing.")))),(0,r.kt)("p",null,"Dynamode provides the ability to scan your items. Scan class allows you to retrieve multiple items without any limitations however they come at cost as scans are expensive, slow, and against ",(0,r.kt)("a",{parentName:"p",href:"https://dynobase.dev/dynamodb-best-practices/"},"best practices"),"."),(0,r.kt)("p",null,"Scan class acts as a build to construct your scan with appropriate filters, to run it use ",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/scan#scanrunoptions"},(0,r.kt)("inlineCode",{parentName:"a"},"Scan.run(options?)"))," method."),(0,r.kt)("h2",{id:"condition"},"Condition"),(0,r.kt)("p",null,"Scan is a child of ",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/condition"},"Condition")," class, meaning that all methods listed on ",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/condition"},"Condition")," page are also available in Scan class. As example you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.attribute(key)")," method to filter out retrieved items."),(0,r.kt)("h2",{id:"new-scanentity-or-entityscan"},(0,r.kt)("inlineCode",{parentName:"h2"},"new Scan(Entity)")," or ",(0,r.kt)("inlineCode",{parentName:"h2"},"Entity.scan()")),(0,r.kt)("p",null,"Every scan has to be initialized with ",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/entity/methods"},"Entity")," to infer its underlying properties. You can achieve this in two ways:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Below definitions are equivalent\nnew Scan(AllPossibleProperties);\nAllPossibleProperties.scan();\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/guide/entity/modeling#all-possible-properties"},"AllPossibleProperties")," is an example class that extends ",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/entity/methods"},"Entity"),"."),(0,r.kt)("h2",{id:"scanindexnamename"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.indexName(name)")),(0,r.kt)("p",null,"The name of a secondary index to scan. This index can be any local secondary index or global secondary index. The ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," parameter is a string, narrowed down to entity index names. It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"IndexName"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"AllPossibleProperties.scan().attribute('LSI_1_SK').beginsWith('s').indexName('LSI_1_NAME'); // Resulting in: `IndexName: LSI_1_NAME`\n")),(0,r.kt)("h2",{id:"scansegmentvalue"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.segment(value)")),(0,r.kt)("p",null,"For a parallel Scan request, segment identifies an individual segment to be scanned by an application worker. The ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," argument must be greater than or equal to 0, and less than the value provided for ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.totalSegments(value)"),". If you use ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.segment(value)"),", you must also use ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.totalSegments(value)"),". It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"Segment"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').totalSegments(10).segment(0); // Resulting in: `Segment: 0`\n")),(0,r.kt)("h2",{id:"scantotalsegmentsvalue"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.totalSegments(value)")),(0,r.kt)("p",null,"For a parallel Scan request, total segments represents the total number of segments into which the Scan operation will be divided. The value of TotalSegments corresponds to the number of application workers that will perform the parallel scan. If you use ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.totalSegments(value)"),", you must also use ",(0,r.kt)("inlineCode",{parentName:"p"},"Scan.segment(value)"),". It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"TotalSegments"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," argument is a number between 1 and 1000000."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').totalSegments(10).segment(0); // Resulting in: `TotalSegments: 10`\n")),(0,r.kt)("h2",{id:"scanlimitcount"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.limit(count)")),(0,r.kt)("p",null,"This method will limit the number of items that DynamoDB scan in one request. It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"Limit"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Unlike most SQL databases ",(0,r.kt)("strong",{parentName:"p"},"this does not guarantee the response will contain 5 items"),". DynamoDB will only scan a maximum of 5 items and check if they match and should be returned.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"count")," argument should be a ",(0,r.kt)("inlineCode",{parentName:"p"},"number")," representing how many items you wish DynamoDB to scan."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').limit(10); // Resulting in: `Limit: 10`\n")),(0,r.kt)("h2",{id:"scanstartatkey"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.startAt(key)")),(0,r.kt)("p",null,"In case there are more items to retrieve in a previous scan response, Dynamode will return ",(0,r.kt)("inlineCode",{parentName:"p"},"lastKey")," property with primary key of last evaluated item. You can pass this property to further scan your items. It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"LastEvaluatedKey"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const response1 = await User.scan().attribute('username').eq('blazej').run(); \nconst response2 = await User.scan().attribute('username').eq('blazej').startAt(response1.lastKey).run(); // Resulting in: `LastEvaluatedKey: response1.lastKey`\n")),(0,r.kt)("h2",{id:"scanconsistent"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.consistent()")),(0,r.kt)("p",null,"This will cause the scan to run a consistent read. By default read is eventually consistent. It uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsistentRead"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').consistent(); // Resulting in: `ConsistentRead: true`\n")),(0,r.kt)("h2",{id:"scancount"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.count()")),(0,r.kt)("p",null,"Instead of returning an array of items, this method will make the scan operation to return an object with count information. This option saves bandwidth by using DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"Select"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').count(); // Resulting in: `Select: 'COUNT'`\n")),(0,r.kt)("h2",{id:"scanattributesattributes"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.attributes(attributes)")),(0,r.kt)("p",null,"This method is used to tag what item attributes should be retrieved and returned. This uses DynamoDB's ",(0,r.kt)("inlineCode",{parentName:"p"},"ProjectionExpression"),". "),(0,r.kt)("p",null,"If this value is ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined"),", then all attributes will be returned. ",(0,r.kt)("inlineCode",{parentName:"p"},"attributes")," argument should be an array of strings representing the property names to return."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"User.scan().attribute('username').eq('blazej').attributes(['username', 'age']); // Resulting in: `ProjectionExpression: 'username, age'`\n")),(0,r.kt)("h2",{id:"scanrunoptions"},(0,r.kt)("inlineCode",{parentName:"h2"},"Scan.run(options?)")),(0,r.kt)("h3",{id:"description"},"Description"),(0,r.kt)("p",null,"This method is used to execute constructed scan and retrieve multiple items from DynamoDB. It uses the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Scan.html"},"Scan DynamoDB operation"),"."),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("p",null,"You can add optional ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"options"))," parameter that is an object. The table below represents options that you can pass in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"return")),(0,r.kt)("td",{parentName:"tr",align:null},"What the method should return. For ",(0,r.kt)("inlineCode",{parentName:"td"},"'default'")," method returns initialized classes with retrieved data. For ",(0,r.kt)("inlineCode",{parentName:"td"},"'input'")," method returns prepared DynamoDB input command and no request is made to DynamoDB (method no longer returns a promise). For ",(0,r.kt)("inlineCode",{parentName:"td"},"'output'")," method returns the bare output from DynamoDB operation."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"'default'")," ","|"," ",(0,r.kt)("inlineCode",{parentName:"td"},"'input'")," ","|"," ",(0,r.kt)("inlineCode",{parentName:"td"},"'output'")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"'default'"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"extraInput")),(0,r.kt)("td",{parentName:"tr",align:null},"Extra input that is passed to ScanInput DynamoDB operation. Use it only in case that you know what are you are doing as it may override other properties passed to DynamoDB operation."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-dynamodb/interfaces/scaninput.html"},(0,r.kt)("inlineCode",{parentName:"a"},"ScanInput"))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"undefined"))))),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"default",label:"return: 'default'",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const result = await User.scan()\n  .attribute('age').eq(18)\n  .attribute('partitionKey').beginsWith('1')\n  .limit(3)\n  .run();\n// OR\nconst result = await User.scan()\n  .attribute('age').eq(18)\n  .attribute('partitionKey').beginsWith('1')\n  .limit(3)\n  .run({ return: 'default' });\n// OUTPUT:\n// {\n//   items: [\n//     User {\n//       dynamodeEntity: 'User',\n//       partitionKey: '1',\n//       sortKey: 'blazej',\n//       username: 'blazej',\n//       email: 'blazej@gmail.com',\n//       age: 18,\n//       friends: [Array],\n//       config: [Object]\n//     }\n//   ],\n//   count: 1,\n//   scannedCount: 3,\n//   lastKey: { partitionKey: '1', sortKey: 'blazej' }\n// }\n"))),(0,r.kt)(s.Z,{value:"input",label:"return: 'input'",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const input = await User.scan()\n  .attribute('age').eq(18)\n  .attribute('partitionKey').beginsWith('1')\n  .limit(3)\n  .run({ return: 'input' });\n// OUTPUT:\n// {\n//   TableName: 'users',\n//   Limit: 3,\n//   FilterExpression: 'age = :age AND begins_with(partitionKey, :partitionKey)',\n//   ExpressionAttributeValues: { ':age': { N: '18' }, ':partitionKey': { S: '1' } }\n// }\n"))),(0,r.kt)(s.Z,{value:"output",label:"return: 'output'",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const output = await User.scan()\n  .attribute('age').eq(18)\n  .attribute('partitionKey').beginsWith('1')\n  .limit(3)\n  .run({ return: 'output' });\n// OUTPUT:\n// {\n//   '$metadata': {\n//     ...\n//   },\n//   ConsumedCapacity: undefined,\n//   Count: 1,\n//   Items: [\n//     {\n//       dynamodeEntity: [Object],\n//       sortKey: [Object],\n//       partitionKey: [Object],\n//       config: [Object],\n//       age: [Object],\n//       email: [Object],\n//       friends: [Object],\n//       username: [Object]\n//     }\n//   ],\n//   LastEvaluatedKey: { partitionKey: { S: '1' }, sortKey: { S: 'blazej' } },\n//   ScannedCount: 3\n// }\n")))))}m.isMDXComponent=!0}}]);